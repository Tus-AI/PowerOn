[TGUC.ACCOUNT.CREATION]

TARGET=ACCOUNT

DEFINE
 #INCLUDE "RD.OUTPUT.DEF"
 FERROR=CHARACTER
 CR=CHARACTER(1)
 MAXFIELD=26
 FILENAME="EpisysFinTechTGUC.csv"
 FN=NUMBER
 ET=CHARACTER
 FO=NUMBER
 EO=CHARACTER
 FIELDS=CHARACTER ARRAY(32)
 I=NUMBER
 BUFFER=CHARACTER
 TMPCHR=CHARACTER
 DATECHR=CHARACTER
 POS=NUMBER
 LF=CHARACTER
 AREF="01-CHARTWAY"
 INDIC=CHARACTER
 TEXTLINE=CHARACTER
 ERROR=CHARACTER
 IND=CHARACTER
 OUTPUTCHANNEL1=NUMBER
 REWARD=MONEY
 ADDZERO=CHARACTER
 TEMPLINE=CHARACTER
 XXX=NUMBER
 PPYEAR=CHARACTER
 PPMONTH=CHARACTER
 PPDAY=CHARACTER
 PPFINALDATE=CHARACTER
 POASTXTPI=NUMBER
 POASTXTPCODELIST=CHARACTER
 FOUND=NUMBER
 TRUE=1
 FALSE=0
 FNAME="POWERPAY.LOOKUP.csv"
 FILENUMBER=NUMBER
 LOOKUPNUM=CHARACTER
 LINECOUNT=NUMBER
 ENDOFLINE=NUMBER
END

SETUP
 CR=CTRLCHR(013)
 LF=CTRLCHR(010)
 NONANSISTANDARD
END

SELECT
 NONE
END

PRINT TITLE="TGUC ACCOUNTS"
HEADER=""

 FILEOPEN("LETTER",FILENAME,"READ",FN,ET)
 FILEREAD(FN,1,BUFFER,ET)
 I=0
 WHILE ET=""
  DO
   WHILELIMIT=1000
   IF BUFFER=CR OR BUFFER=LF THEN
    DO
     FILEREAD(FN,1,BUFFER,ET)
    
     CALL PRINTOUTPUT
     CALL RESETFIELDS
	 FILEDELETE("LETTER",FILENAME,ET)
	 
    END
  
   ELSE IF BUFFER="," THEN
   
    I=I+1
   ELSE IF I<=MAXFIELD THEN
    FIELDS(I)=FIELDS(I)+BUFFER
   FILEREAD(FN,1,BUFFER,ET)
  END
  

 FILECLOSE(FN,ET)
END
 
[************************************************************************]

PROCEDURE RESETFIELDS

 FOR I=0 TO MAXFIELD
  DO
   FIELDS(I)=""
  END

 I=0

END [RESETFIELDS]

[************************************************************************]

PROCEDURE PRINTOUTPUT
		
	 FOUND=FALSE
	 FOR ACCOUNT WITH LOOKUP UPPERCASE(FIELDS(19))
	  DO
	   [[FOR EACH LOOKUP WITH LOOKUP:NUMBER=UPPERCASE(FIELDS(19))
	    DO]
		 FOUND=TRUE
		 
	  [END]
	    END
  [ UNTIL FOUND=TRUE]]
  
   FOR EACH LOOKUP WITH LOOKUP:TYPE=15 AND LOOKUP:NUMBER=UPPERCASE(FIELDS(19))
	    DO
	   [FOR EACH LOOKUP WITH LOOKUP:NUMBER=UPPERCASE(FIELDS(19))
	    DO]
		 FOUND=TRUE
		END 
	  [END]
	    END

	 IF FIELDS(0)="1" OR FIELDS(0)="3"  THEN
	  DO
	   IF FOUND = FALSE THEN
	    DO
	  OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,FERROR)
      Print "ACCOUNT NEXTACCOUNT CREATE TYPE 0000"
      NewLine
      Print "SET OPENDATE TO"
      Col = 049 [systemdate]FIELDS(21)
      NewLine  
	  
      Print "SET BRANCH TO 137"
      NewLine
	  
	 
	  Print "SET WARNINGCODE:3 TO 87"
	  NEWLINE
	  
	  Print "SET ESTMTENABLE TO 1"
	  NEWLINE
	   
	  
	  PRINT "SET REFERENCE TO"
	  COL=049 AREF
	  NEWLINE
	  
	  PRINT "SET MEMBERGROUP TO"
	  COL=049 843
	  NEWLINE
	  
	  TMPCHR=FIELDS(3)
	  CALL POASTXTPCODEPARSE
	  PRINT "SET NAME:FIRST TO"
      COL=093 UPPERCASE(FIELDS(3))
	  NEWLINE
	  
	  TMPCHR=FIELDS(4)
	   CALL POASTXTPCODEPARSE
	  PRINT "SET NAME:MIDDLE TO"
      COL=093 UPPERCASE(POASTXTPCODELIST)
	  NEWLINE
	  
	  TMPCHR=FIELDS(5)
	  CALL POASTXTPCODEPARSE	  
	  PRINT "SET NAME:LAST TO"
      COL=093 UPPERCASE(POASTXTPCODELIST)
	  NEWLINE
	  
	  TMPCHR=FIELDS(6)
	  CALL STRIPDASH
	  PRINT "SET NAME:SSN TO"
      COL=093 [FIELDS(6)]TMPCHR
	  NEWLINE
	  
	 [ PPYEAR=SEGMENT(FIELDS(7),1,4)
	  PPMONTH=SEGMENT(FIELDS(7),6,7)
	  PPDAY=SEGMENT(FIELDS(7),9,10)
	  PPFINALDATE=PPMONTH+"/"+PPDAY+"/"+PPYEAR]
	  PRINT "SET NAME:BIRTHDATE TO"
      COL=049 FIELDS(7)
	  NEWLINE
	  
	  PRINT "SET NAME:HOMEPHONE TO"
      COL=093 FIELDS(8)
	  NEWLINE
	  
	  PRINT "SET NAME:WORKPHONE TO"
      COL=093 FIELDS(9)
	  NEWLINE
	  
	  PRINT "SET NAME:MOBILEPHONE TO"
      COL=093 FIELDS(10)
	  NEWLINE
	  
	  PRINT "SET NAME:EMAIL TO"
      COL=093 FIELDS(11)
	  NEWLINE
	  
	 [ TMPCHR=FIELDS(12)]
	  [CALL POASTXTPCODEPARSE]	  
	  PRINT "SET NAME:STREET TO"
      [COL=093 UPPERCASE(POASTXTPCODELIST)]
	  COL=093 UPPERCASE(FIELDS(12))
	  NEWLINE
	  
	  TMPCHR=FIELDS(13)
	  CALL POASTXTPCODEPARSE
	  PRINT "SET NAME:CITY TO"
      COL=093 UPPERCASE(POASTXTPCODELIST)
	  NEWLINE
	  
	  TMPCHR=FIELDS(14)
	  CALL POASTXTPCODEPARSE
	  PRINT "SET NAME:STATE TO"
      COL=093 UPPERCASE(POASTXTPCODELIST)
	  NEWLINE
	  
	  PRINT "SET NAME:ZIPCODE TO"
      COL=093 UPPERCASE(FIELDS(15))
	  NEWLINE
	  
	  TMPCHR=FIELDS(16)
	  CALL POASTXTPCODEPARSE
	  PRINT "SET NAME:EMPLOYERNAME TO"
      COL=093 UPPERCASE(POASTXTPCODELIST)
	  NEWLINE
	  
	  
	  PRINT "SET NAME:OCCUPATION TO"
      COL=093 UPPERCASE(FIELDS(17))
	  NEWLINE
	  
	  PRINT "SET NAME:USPERSONFLAG TO"
      COL=093 [FIELDS(18)]"1"
	  NEWLINE
	  
	  PRINT "SET NAME:IDENTIDNUMBER:1 TO"
      COL=093 FIELDS(23)
	  NEWLINE
	  
	  IF FIELDS(24)="" THEN
	   DO
	  PRINT "SET NAME:IDENTIDTYPE:1 TO"
      COL=093 [FIELDS(24)]"000"
	  END
	  ELSE DO
	   PRINT "SET NAME:IDENTIDTYPE:1 TO"
      COL=093 FIELDS(24)
	  END
	  NEWLINE
	  
	  IF FIELDS(25)="" THEN
	   DO
	  PRINT "SET NAME:IDENTIDISSUEDATE:1 TO"
      COL=093 [FIELDS(25)]'--/--/--'
	  END
	  ELSE DO
	   PRINT "SET NAME:IDENTIDISSUEDATE:1 TO"
       COL=093 FIELDS(25)
	  END
	  NEWLINE
	  
	  IF FIELDS(26)="" THEN
	   DO
	  PRINT "SET NAME:IDENTIDEXPIREDATE:1 TO"
      COL=093 [FIELDS(26)]'--/--/--'
	  END
	  ELSE DO
	   PRINT "SET NAME:IDENTIDEXPIREDATE:1 TO"
      COL=093 FIELDS(26)
	  END
	  NEWLINE
	  
	  PRINT "ACCOUNT LASTCREATE CREATE SHARE 0000 TYPE 0000"
	  NEWLINE
	  
	  PRINT "ACCOUNT LASTCREATE CREATE LOOKUP LOC AFTERLAST"
	  NEWLINE
	  PRINT "SET TYPE TO 15"
	  NEWLINE
	  PRINT "SET IDTYPE TO 2"
	  NEWLINE
	  PRINT "SET NUMBER TO"
	  COL=49 UPPERCASE(FIELDS(19))
	  NEWLINE  
	 
	 END
	
	 END 
	
	
	
[====================================== CREATE LOOKUP =======================================]	 
   ELSE IF FIELDS(0)="2" THEN
	   DO
	   
	 ADDZERO=FORMAT("9999999999",VALUE(FIELDS(1)))
	 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,FERROR)
	 
	 FOR ACCOUNT WITH NUMBER ADDZERO
	  DO
	   IF NOT ANYWARNING(ACCOUNT,87) THEN
	    DO
	   PRINT "ACCOUNT "+ADDZERO+" MODIFY"
       NEWLINE
       PRINT " CHANGE SETWARNING 87 --/--/--"
       NEWLINE
	  END
	  
	  PRINT "ACCOUNT "+ADDZERO+" CREATE LOOKUP AFTERLAST"
	  NEWLINE
	  PRINT "SET TYPE TO 15"
	  NEWLINE
	  PRINT "SET IDTYPE TO 2"
	  NEWLINE
	  PRINT "SET NUMBER TO"
	  COL=49 UPPERCASE(FIELDS(19))
	  NEWLINE
	 END 
	END
[=====================================END CREATE LOOKUP========================================]

[=======================================SET WARNING============================================]

ELSE IF FIELDS(0)="4" THEN
	   DO
	   
	 ADDZERO=FORMAT("9999999999",VALUE(FIELDS(1)))
	 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,FERROR)
	 
	 FOR ACCOUNT WITH NUMBER ADDZERO
	  DO
	   IF NOT ANYWARNING(ACCOUNT,87) THEN
	    DO
	   PRINT "ACCOUNT "+ADDZERO+" MODIFY"
       NEWLINE
       PRINT " CHANGE SETWARNING 87 --/--/--"
       NEWLINE
	  END
	 END
	END

[=========================END SET WARNING======================================================]


[========================================EXPIRE WARNING========================================]
    ELSE IF FIELDS(0)="5" THEN
	   DO
	   
	 ADDZERO=FORMAT("9999999999",VALUE(FIELDS(1)))
	 OUTPUTSWITCH(OUTPUTCHANNELDEFAULT,FERROR)
	 
	 FOR ACCOUNT WITH NUMBER ADDZERO
	  DO
	   IF ANYWARNING(ACCOUNT,87) THEN
	    DO
		  [FOR EACH LOOKUP WITH LOOKUP WITH LOOKUP:TYPE=13 AND] 
		    PRINT "ACCOUNT "+ADDZERO+" MODIFY ACCOUNT "
     		NEWLINE
     		[PRINT " CHANGE SETWARNING 88 "]
			PRINT " CHANGE CLEARWARNING 87"
     		[PRINT SYSTEMDATE]
	        NEWLINE
	  END
	  
     [ END]
	  
	 END 
	
 END
[======================================END EXPIRE WARNING=======================================]
END
 
 PROCEDURE STRIPDASH
 IF CHARACTERSEARCH(TMPCHR,"-")>0 THEN
  DO
   TEMPLINE=""
   FOR XXX=1 TO LENGTH(TMPCHR)
    DO
     IF SEGMENT(TMPCHR,XXX,XXX)<>"-" THEN
      TEMPLINE=TEMPLINE+SEGMENT(TMPCHR,XXX,XXX)
     END
    TMPCHR=TEMPLINE
  END
END

==============strip quote from a word=============
 PROCEDURE STRIPQUOTE
 IF CHARACTERSEARCH(TMPCHR,"'")>0 THEN
  DO
   TEMPLINE=""
   FOR XXX=1 TO LENGTH(TMPCHR)
    DO
     IF SEGMENT(TMPCHR,XXX,XXX)<>"'" THEN
      TEMPLINE=TEMPLINE+SEGMENT(TMPCHR,XXX,XXX)
     END
    TMPCHR=TEMPLINE
  END
END

 PROCEDURE STRIPEXLAIM
 IF CHARACTERSEARCH(TMPCHR,",")>0 THEN
  DO
   TEMPLINE=""
   FOR XXX=1 TO LENGTH(TMPCHR)
    DO
     IF SEGMENT(TMPCHR,XXX,XXX)<>"," THEN
      TEMPLINE=TEMPLINE+SEGMENT(TMPCHR,XXX,XXX)
     END
    TMPCHR=TEMPLINE
  END
END

PROCEDURE POASTXTPCODEPARSE
 POASTXTPCODELIST=""
 IF TMPCHR<>"" THEN 
  DO
   FOR POASTXTPI=1 TO LENGTH(TMPCHR)
    DO
     IF (SEGMENT(TMPCHR,POASTXTPI,POASTXTPI)>="A" AND
         SEGMENT(TMPCHR,POASTXTPI,POASTXTPI)<="Z") OR
        (SEGMENT(TMPCHR,POASTXTPI,POASTXTPI)>="a" AND
         SEGMENT(TMPCHR,POASTXTPI,POASTXTPI)<="z") OR SEGMENT(TMPCHR,POASTXTPI,POASTXTPI)=" "
		 
		 THEN
      DO
       POASTXTPCODELIST=POASTXTPCODELIST+SEGMENT(TMPCHR,POASTXTPI,
        POASTXTPI)
      END  
    END
  END
END


